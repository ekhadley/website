#!/bin/bash

project="/home/ek/wgmn/website"
service_name="website_flask.service"

# Handle subcommands
case "$1" in
    test)
        # Run locally with flask development server
        cd "$project"
        python app.py
        ;;
    kill)
        # Kill the systemd service
        sudo systemctl stop "$service_name"
        systemctl status "$service_name" --no-pager
        ;;
    restart)
        # Restart the systemd service
        sudo systemctl restart "$service_name"
        sleep 1
        systemctl status "$service_name" --no-pager
        ;;
    enable)
        # Enable the systemd service (start on boot)
        sudo systemctl enable "$service_name"
        systemctl is-enabled "$service_name"
        ;;
    disable)
        # Disable the systemd service (don't start on boot)
        sudo systemctl disable "$service_name"
        systemctl is-enabled "$service_name" || echo "Service is disabled"
        ;;
    status)
        # Show the systemd service status
        systemctl status "$service_name" --no-pager
        ;;
    "")
        # Default: check if service is running, start if not, show status if running
        if systemctl is-active --quiet "$service_name"; then
            echo "Service is running. Status:"
            systemctl status "$service_name" --no-pager
        else
            echo "Service is not running. Starting..."
            sudo systemctl start "$service_name"
            sleep 1
            systemctl status "$service_name" --no-pager
        fi
        ;;
    *)
        echo "Usage: $0 [test|kill|restart|enable|disable|status]"
        echo "  test    - Run locally with flask development server"
        echo "  kill    - Stop the systemd service"
        echo "  restart - Restart the systemd service"
        echo "  enable  - Enable the systemd service (start on boot)"
        echo "  disable - Disable the systemd service (don't start on boot)"
        echo "  status  - Show the systemd service status"
        echo "  (no args) - Start service if not running, show status if running"
        exit 1
        ;;
esac

